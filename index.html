<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV –ü–ª–µ–π–ª–∏—Å—Ç | –ü—Ä–æ—Å–º–æ—Ç—Ä M3U</title>
    <link rel="icon" href="https://raw.githubusercontent.com/kyiv14/iptv-online/refs/heads/main/icon.ico">
    
    <style>
        /* VARIABLES - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç index.html */
        :root {
            --primary-color: #dc2625; /* Red-700 */
            --secondary-color: #ffffff;
            --background-color: #f5f5f7; 
            --text-color: #1d1d1f;
            --border-color: #e3e3e3; 
            --shadow-color: rgba(0, 0, 0, 0.05);
            --transition-duration: 0.2s;
            --success-color: #34c759; /* –ó–µ–ª–µ–Ω—ã–π */
            --error-color: var(--primary-color); /* –ö—Ä–∞—Å–Ω—ã–π */
        }
        
        /* BASE STYLES */
        body {
            font-family: 'SF Pro Text', 'SF Pro Icons', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif;
            background-color: var(--background-color);
            padding: 30px 20px;
            margin: 0;
            color: var(--text-color);
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* –°—Ç–∏–ª—å –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
        h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 30px;
            text-align: center;
        }

        /* –°–µ–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏/–ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è */
        .upload-section {
            padding: 30px;
            margin-bottom: 30px;
            border: 2px dashed var(--primary-color);
            background-color: var(--secondary-color);
            border-radius: 18px;
            text-align: center;
            transition: background-color var(--transition-duration), border-color var(--transition-duration);
            box-shadow: 0 4px 12px var(--shadow-color);
            cursor: pointer;
        }

        .upload-section:hover, .upload-section.dragover {
            border-color: var(--success-color);
            background-color: #fafafa;
        }

        .upload-section p {
            margin: 5px 0;
            font-size: 16px;
            color: var(--text-color);
        }

        .upload-button {
            background-color: var(--primary-color);
            color: var(--secondary-color);
            border: none;
            padding: 14px 20px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-duration) ease;
            margin-top: 15px;
            box-shadow: 0 2px 4px rgba(220, 38, 37, 0.2);
        }

        .upload-button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .upload-button:active {
            transform: translateY(1px) scale(0.99); 
            box-shadow: 0 1px 2px rgba(220, 38, 37, 0.2);
        }


        #file-input {
            display: none;
        }
        
        /* –°–µ–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ */
        .search-container {
            margin-bottom: 30px;
        }

        #search-input {
            width: 100%;
            padding: 12px 15px;
            font-size: 15px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            box-shadow: inset 0 1px 3px var(--shadow-color);
            box-sizing: border-box;
            outline: none;
            color: var(--text-color);
            background: var(--secondary-color);
            transition: border-color var(--transition-duration) ease, box-shadow var(--transition-duration) ease;
        }

        #search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(220, 38, 37, 0.15);
        }

        /* –°—Ç–∏–ª—å –∫–Ω–æ–ø–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–ü–õ–ê–®–ö–ò) */
        #category-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 15px 0;
            margin-bottom: 20px;
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .category-button {
            display: inline-block;
            background-color: #e9e9e9; 
            color: var(--text-color);
            border: none;
            padding: 8px 15px;
            border-radius: 20px; 
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color var(--transition-duration), box-shadow var(--transition-duration);
            flex-shrink: 0;
            user-select: none;
        }
        
        .category-button:hover {
            background-color: #d8d8d8; 
        }

        .category-button.active {
            background-color: var(--primary-color);
            color: var(--secondary-color);
            font-weight: 600;
        }
        
        /* –°—Ç–∏–ª—å –≥—Ä—É–ø–ø—ã –∫–∞–Ω–∞–ª–æ–≤ */
        h2 {
            font-size: 20px; 
            font-weight: 600;
            color: var(--text-color);
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            text-align: center; 
        }
        
        /* –°–µ—Ç–∫–∞ –¥–ª—è –ø–ª–∏—Ç–æ–∫ */
        .channel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); 
            gap: 20px; 
            list-style: none;
            padding: 0;
            margin: 0;
        }

        /* –°—Ç–∏–ª—å –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–π –ø–ª–∏—Ç–∫–∏ –∫–∞–Ω–∞–ª–∞ */
        .channel-tile {
            background-color: var(--secondary-color);
            border-radius: 18px; 
            overflow: hidden;
            text-align: center;
            padding: 15px;
            box-shadow: 0 4px 12px var(--shadow-color);
            transition: transform var(--transition-duration) ease, box-shadow var(--transition-duration) ease;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            aspect-ratio: 1 / 1;
            min-height: 150px;
            position: relative;
        }
        
        .channel-tile:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        .channel-tile:active {
            transform: translateY(1px) scale(0.99); 
        }

        .channel-logo {
            width: 80%;
            height: auto;
            max-height: 80%;
            object-fit: contain;
            border-radius: 8px;
            margin-bottom: 10px;
            flex-grow: 1; 
        }
        
        /* –ó–∞–≥–ª—É—à–∫–∞, –µ—Å–ª–∏ –Ω–µ—Ç –ª–æ–≥–æ—Ç–∏–ø–∞ */
        .logo-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 80%;
            height: 80%;
            background-color: #f7f7f9;
            border-radius: 8px;
            color: #888;
            font-size: 1.5rem;
            margin-bottom: 10px;
            flex-grow: 1;
        }

        .channel-name {
            font-size: 14px;
            font-weight: 500;
            line-height: 1.2;
            word-break: break-word;
            flex-shrink: 0;
            overflow: hidden;
            max-height: 2.4em; 
        }
        
        .message {
            color: var(--text-color);
            font-weight: 500;
            margin-top: 15px;
            text-align: center;
            font-size: 16px;
        }
        
        .error-message {
            color: var(--error-color);
            font-weight: 600;
        }
        
        .success-message {
            color: var(--success-color);
            font-weight: 600;
        }
        
        /* --- –°—Ç–∏–ª–∏ –¥–ª—è –ú–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ü–ª–µ–µ—Ä–∞ (–ù–æ–≤—ã–π –±–ª–æ–∫) --- */
        .modal {
            display: none; 
            position: fixed;
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85); 
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            overflow: hidden; 
        }

        .modal-content {
            background-color: var(--text-color); /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –ø–ª–µ–µ—Ä–∞ */
            margin: auto;
            border-radius: 18px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
            max-width: 95%;
            width: 90%; 
            max-height: 95%;
            height: 90%;
            position: relative;
            animation: animatetop 0.4s;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .modal-header {
            padding: 15px;
            color: var(--secondary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(28, 28, 30, 0.9); /* –ü–æ—á—Ç–∏ —á–µ—Ä–Ω—ã–π */
            border-top-left-radius: 18px;
            border-top-right-radius: 18px;
            position: relative;
            z-index: 10;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding-right: 20px;
        }

        .modal-close {
            color: #ccc;
            font-size: 32px;
            font-weight: 300;
            cursor: pointer;
            transition: 0.3s;
        }

        .modal-close:hover,
        .modal-close:focus {
            color: var(--primary-color);
            text-decoration: none;
        }

        #player-iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
            background-color: #000;
            flex-grow: 1;
        }

        @keyframes animatetop {
            from {opacity: 0}
            to {opacity: 1}
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 740px) {
            .channel-grid {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
                gap: 15px;
            }
            .modal-content {
                width: 100%;
                height: 100%;
                max-width: 100%;
                max-height: 100%;
                border-radius: 0;
            }
            .modal-header {
                border-radius: 0;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>IPTV –ü–ª–µ–π–ª–∏—Å—Ç üì∫</h1>
    
    <div id="uploadSection" class="upload-section">
        <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –ø–ª–µ–π–ª–∏—Å—Ç–∞ (.m3u, .m3u8) —Å—é–¥–∞</p>
        <button class="upload-button" onclick="document.getElementById('file-input').click()">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</button>
        <input type="file" id="file-input" accept=".m3u,.m3u8" />
        <p id="uploadMessage" class="message">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã M3U/M3U8.</p>
    </div>

    <div class="search-container">
        <input type="text" id="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∫–∞–Ω–∞–ª–∞–º –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º..." disabled>
    </div>
    
    <div id="category-filter">
        </div>

    <div id="channel-list">
        <p class="message" style="color: #6c757d;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–ª–µ–π–ª–∏—Å—Ç, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤.</p>
    </div>
</div>

<div id="playerModal" class="modal" onclick="closeModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <h3 id="modalTitle">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–Ω–∞–ª–∞...</h3>
            <span class="modal-close" onclick="closeModal(event)">&times;</span>
        </div>
        <iframe id="player-iframe" src="" allowfullscreen frameborder="0" allow="autoplay"></iframe>
    </div>
</div>

<script>
    // --- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º ---
    const playerModal = document.getElementById('playerModal');
    const playerIframe = document.getElementById('player-iframe');
    const modalTitle = document.getElementById('modalTitle');
    
    // --- –£—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ ---

    function parseM3U(content) {
        const lines = content.trim().split('\n');
        const channels = [];
        let currentChannel = { name: '', logo: '', group: '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', url: '' };
        let isInChannelBlock = false;

        const extinfRegex = /#EXTINF:.*?,(.+)/; 
        const logoRegex = /tvg-logo="([^"]*)"/i; 
        const groupTitleRegex = /group-title="([^"]*)"/i;

        for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();

            if (line.startsWith('#EXTINF')) {
                if (isInChannelBlock && currentChannel.name && !currentChannel.url) {
                    currentChannel = { name: '', logo: '', group: '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', url: '' };
                }

                const extinfMatch = line.match(extinfRegex);
                const logoMatch = line.match(logoRegex);
                const groupMatch = line.match(groupTitleRegex);

                if (extinfMatch) {
                    currentChannel.name = extinfMatch[1] ? extinfMatch[1].trim() : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–Ω–∞–ª';
                    currentChannel.logo = logoMatch ? logoMatch[1].trim() : '';
                    currentChannel.group = groupMatch ? groupMatch[1].trim() : '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
                    currentChannel.url = ''; 
                    isInChannelBlock = true;
                }
            } else if (line.startsWith('#EXTGRP:')) {
                if (isInChannelBlock) {
                    currentChannel.group = line.substring(8).trim();
                }
            }
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ URL –ø–æ—Ç–æ–∫–∞
            else if ((line.startsWith('http') || line.startsWith('https')) && line.length > 10) {
                if (isInChannelBlock && currentChannel.name) { 
                    const originalUrl = line.trim();
                    currentChannel.url = originalUrl;
                    channels.push({ ...currentChannel }); 
                    currentChannel = { name: '', logo: '', group: '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', url: '' };
                    isInChannelBlock = false;
                }
            }
        }
        return channels.filter(c => c.name && c.url); // –§–∏–ª—å—Ç—Ä—É–µ–º –∫–∞–Ω–∞–ª—ã –±–µ–∑ URL
    }

    function groupChannels(channels) {
        return channels.map(c => ({
            ...c,
            normalizedName: c.name.toLowerCase(),
            normalizedGroup: c.group.toLowerCase()
        })).reduce((acc, channel) => {
            const group = channel.group || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'; 
            if (!acc[group]) {
                acc[group] = [];
            }
            acc[group].push(channel);
            return acc;
        }, {});
    }

    function renderChannels(groupedChannels) {
        const listContainer = document.getElementById('channel-list');
        listContainer.innerHTML = ''; 
        
        window.allChannelsData = groupedChannels;

        const allGroups = Object.keys(groupedChannels);
        if (allGroups.length === 0 || allGroups.every(group => groupedChannels[group].length === 0)) {
             listContainer.innerHTML = '<p class="message error-message">–ü–ª–µ–π–ª–∏—Å—Ç –ø—É—Å—Ç –∏–ª–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤.</p>';
             document.getElementById('category-filter').innerHTML = '';
             return;
        }
        
        createCategoryButtons(allGroups);

        allGroups.forEach(group => {
            if (groupedChannels[group].length === 0) return;
            
            const groupContainer = document.createElement('div');
            groupContainer.classList.add('channel-group-container');
            groupContainer.setAttribute('data-category', group); 

            const groupTitle = document.createElement('h2');
            groupTitle.textContent = group;
            groupContainer.appendChild(groupTitle);

            const grid = document.createElement('ul');
            grid.classList.add('channel-grid');

            groupedChannels[group].forEach(channel => {
                const tile = document.createElement('a'); 
                // –í–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ href, –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è JS
                tile.href = "#"; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É
                tile.setAttribute('data-url', channel.url); // –°–æ—Ö—Ä–∞–Ω—è–µ–º URL
                tile.setAttribute('data-name', channel.name); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º—è
                
                // --- –î–û–ë–ê–í–õ–ï–ù–ò–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–ê –ö–õ–ò–ö–ê ---
                tile.addEventListener('click', (e) => {
                    e.preventDefault(); // –ó–∞–ø—Ä–µ—â–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ
                    openPlayerModal(channel.url, channel.name);
                });
                // ------------------------------------

                tile.classList.add('channel-tile');
                tile.setAttribute('data-name', channel.name); 
                tile.setAttribute('data-group', channel.group); 

                if (channel.logo) {
                    const logo = document.createElement('img');
                    logo.classList.add('channel-logo');
                    logo.src = channel.logo;
                    logo.alt = channel.name;
                    logo.loading = 'lazy'; 
                    logo.onerror = function() {
                         this.style.display='none';
                         const placeholder = document.createElement('div');
                         placeholder.classList.add('logo-placeholder');
                         placeholder.textContent = channel.name ? channel.name.substring(0, 2).toUpperCase() : 'P';
                         this.parentNode.insertBefore(placeholder, this.nextSibling);
                    }; 
                    tile.appendChild(logo);
                } else {
                    const placeholder = document.createElement('div');
                    placeholder.classList.add('logo-placeholder');
                    placeholder.textContent = channel.name ? channel.name.substring(0, 2).toUpperCase() : 'P';
                    tile.appendChild(placeholder);
                }

                const name = document.createElement('span');
                name.classList.add('channel-name');
                name.textContent = channel.name;

                tile.appendChild(name);
                grid.appendChild(tile);
            });

            groupContainer.appendChild(grid);
            listContainer.appendChild(groupContainer);
        });
        
        const allButton = document.querySelector('#category-filter button[data-filter="all"]');
        if(allButton) allButton.classList.add('active');
        filterChannels(searchInput.value);
    }
    
    // --- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ú–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ ---
    
    function openPlayerModal(url, name) {
        modalTitle.textContent = name;
        playerIframe.src = url; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º URL –ø–æ—Ç–æ–∫–∞
        playerModal.style.display = 'flex';
        document.body.style.overflow = 'hidden'; // –ó–∞–ø—Ä–µ—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Ñ–æ–Ω–∞
    }

    function closeModal(event) {
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–ª–∏–∫ –±—ã–ª –ø–æ –∫—Ä–µ—Å—Ç–∏–∫—É, –ø–æ —Ñ–æ–Ω—É –∏–ª–∏ –ø–æ span.modal-close
        if (event.target === playerModal || event.target.className === "modal-close") {
            playerModal.style.display = 'none';
            playerIframe.src = ''; // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ, –æ—á–∏—â–∞—è src
            modalTitle.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–Ω–∞–ª–∞...'; // –°–±—Ä–æ—Å
            document.body.style.overflow = ''; // –†–∞–∑—Ä–µ—à–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Ñ–æ–Ω–∞
        }
    }
    
    // --- –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –Ω–æ –≤–∫–ª—é—á–µ–Ω—ã –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã) ---

    function createCategoryButtons(categories) {
        const filterContainer = document.getElementById('category-filter');
        filterContainer.innerHTML = ''; 

        const allButton = document.createElement('button');
        allButton.textContent = '–í—Å–µ';
        allButton.classList.add('category-button');
        allButton.setAttribute('data-filter', 'all');
        filterContainer.appendChild(allButton);
        
        categories.forEach(category => {
            const button = document.createElement('button');
            button.textContent = category;
            button.classList.add('category-button');
            button.setAttribute('data-filter', category);
            filterContainer.appendChild(button);
        });

        filterContainer.removeEventListener('click', handleCategoryFilterClick); 
        filterContainer.addEventListener('click', handleCategoryFilterClick);
    }
    
    function handleCategoryFilterClick(event) {
        const target = event.target;
        if (!target.classList.contains('category-button')) return;

        const selectedCategory = target.getAttribute('data-filter');
        const containers = document.querySelectorAll('.channel-group-container');
        const buttons = document.querySelectorAll('.category-button');

        buttons.forEach(btn => btn.classList.remove('active'));
        target.classList.add('active');
        
        searchInput.value = ''; 

        let visibleGroupsCount = 0;

        containers.forEach(container => {
            const category = container.getAttribute('data-category');
            
            if (selectedCategory === 'all' || category === selectedCategory) {
                container.style.display = '';
                container.querySelectorAll('.channel-tile').forEach(tile => {
                     tile.style.display = '';
                });
                visibleGroupsCount++;
            } else {
                container.style.display = 'none';
            }
        });
        
        const noResultsMessage = document.querySelector('#channel-list > .message');
        if (noResultsMessage) noResultsMessage.remove();
        
        if (visibleGroupsCount === 0) {
            document.getElementById('channel-list').insertAdjacentHTML('beforeend', '<p class="message error-message">–ö–∞–Ω–∞–ª—ã –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>');
        }
    }


    const searchInput = document.getElementById('search-input');

    function filterChannels(searchTerm) {
        const term = searchTerm.toLowerCase().trim();
        const allGroupContainers = document.querySelectorAll('.channel-group-container');
        let visibleChannelsCount = 0;
        
        if (term.length > 0) {
            document.querySelectorAll('.category-button').forEach(btn => btn.classList.remove('active'));
        } else {
            const allButton = document.querySelector('#category-filter button[data-filter="all"]');
            if(allButton) allButton.classList.add('active');
        }

        allGroupContainers.forEach(groupContainer => {
            const groupTitleEl = groupContainer.querySelector('h2');
            const groupTitle = groupTitleEl ? groupTitleEl.textContent.toLowerCase() : '';
            const tiles = groupContainer.querySelectorAll('.channel-tile');
            
            let hasVisibleTiles = false;

            tiles.forEach(tile => {
                const channelName = tile.getAttribute('data-name').toLowerCase();
                const isMatch = channelName.includes(term) || groupTitle.includes(term);

                if (isMatch) {
                    tile.style.display = '';
                    hasVisibleTiles = true;
                    visibleChannelsCount++;
                } else {
                    tile.style.display = 'none';
                }
            });

            if (hasVisibleTiles) {
                groupContainer.style.display = '';
            } else {
                groupContainer.style.display = 'none';
            }
        });

        let noResultsMessage = document.querySelector('#channel-list > .message');
        if (noResultsMessage) {
            noResultsMessage.remove();
        }

        if (visibleChannelsCount === 0 && term.length > 0) {
             const messageHTML = `<p class="message error-message">–ü–æ –∑–∞–ø—Ä–æ—Å—É "${searchTerm}" –∫–∞–Ω–∞–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>`;
             document.getElementById('channel-list').insertAdjacentHTML('beforeend', messageHTML);
        }
    }

    searchInput.addEventListener('input', (event) => {
        filterChannels(event.target.value);
    });

    const fileInput = document.getElementById('file-input');
    const uploadSection = document.getElementById('uploadSection');
    const uploadMessage = document.getElementById('uploadMessage');
    const searchInputEl = document.getElementById('search-input');


    function handleFile(file) {
        if (!file) return;

        uploadMessage.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞...';
        uploadMessage.classList.remove('error-message', 'success-message');
        uploadMessage.classList.add('message');
        searchInputEl.value = ''; 
        searchInputEl.disabled = true; 
        document.getElementById('channel-list').innerHTML = ''; 
        document.getElementById('category-filter').innerHTML = ''; 

        const reader = new FileReader();
        
        reader.onload = function(e) {
            const content = e.target.result;
            
            if (!content.trim().startsWith('#EXTM3U')) {
                uploadMessage.textContent = '–û—à–∏–±–∫–∞: –§–∞–π–ª –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º M3U –ø–ª–µ–π–ª–∏—Å—Ç–æ–º (–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç #EXTM3U).';
                uploadMessage.classList.add('error-message');
                return;
            }

            const allChannels = parseM3U(content);
            const grouped = groupChannels(allChannels);
            
            renderChannels(grouped);
            
            if (allChannels.length > 0) {
                 uploadMessage.textContent = `–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ ${allChannels.length} –∫–∞–Ω–∞–ª–æ–≤.`;
                 uploadMessage.classList.add('success-message');
                 searchInputEl.disabled = false; 
            } else {
                 uploadMessage.textContent = '–ü–ª–µ–π–ª–∏—Å—Ç –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–æ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤.';
                 uploadMessage.classList.add('error-message');
            }
        };

        reader.onerror = function() {
            uploadMessage.textContent = '–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞.';
            uploadMessage.classList.add('error-message');
        };

        reader.readAsText(file);
    }

    fileInput.addEventListener('change', function(event) {
        if (event.target.files.length > 0) {
            handleFile(event.target.files[0]);
            event.target.value = ''; 
        }
    });

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        uploadSection.addEventListener(eventName, (e) => {
            e.preventDefault();
            e.stopPropagation();
        }, false);
    });

    ['dragenter', 'dragover'].forEach(eventName => {
        uploadSection.addEventListener(eventName, () => {
            uploadSection.classList.add('dragover');
        }, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        uploadSection.addEventListener(eventName, () => {
            uploadSection.classList.remove('dragover');
        }, false);
    });

    uploadSection.addEventListener('drop', (e) => {
        const dt = e.dataTransfer;
        const files = dt.files;
        if (files.length > 0) {
            handleFile(files[0]);
        }
    }, false);
    
</script>
</body>
</html>